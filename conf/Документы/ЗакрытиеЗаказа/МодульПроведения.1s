// ===============================
Функция ПроверкаШапки()
	глВсеВыбрано = 1;
	глПроверкаДатыДок(Контекст,"Проведение");
	глВыбранЛи(Фирма,"Фирма");
	Возврат глВсеВыбрано;
КонецФункции

// ===============================
Функция ПроверкаСтроки()
    глВсеВыбрано = 1;
	глВыбранЛи(ДокументРезерва,"Счет",НомерСтроки);
	Возврат глВсеВыбрано;
КонецФункции

// ===============================
Процедура ОбработкаПроведения()
	Перем ТаблИтогов;
	глКомментарий("Начало",2,Контекст);
	
	Если ПроверкаШапки() = 0 Тогда
	    глНеПроводить(Контекст);
		Возврат;
	КонецЕсли;
	
	Если КоличествоСтрок()=0 Тогда
	    глНеПроводить(Контекст,"В документе должна быть хотя бы одна строка!");
		Возврат;
	КонецЕсли;
	// по Регистру Резервы (снимаем с резерва все ТМЦ по выбранным Счетам)

	Ит = СоздатьОбъект("БухгалтерскиеИтоги");
	списЗаказов = СоздатьОбъект("СписокЗначений");
	ВыгрузитьТабличнуюЧасть(списЗаказов);
	Ит.ИспользоватьСубконто(ВидыСубконто.ЗаказыПоставщикам, списЗаказов, 1);
	Ит.ИспользоватьСубконто(ВидыСубконто.ТМЦ, , 1);
	Ит.ИспользоватьСубконто(ВидыСубконто.Контрагенты, , 1);
	Ит.Опции(1);
	Ит.ВыполнитьЗапрос(, ?(ДатаЗапроса = Дата(0), ДатаДок, ДатаЗапроса), "ЗП");
	
	Ит.ВыбратьСубконто(1);
	Пока Ит.ПолучитьСубконто(1) = 1 Цикл
		Ит.ВыбратьСубконто(2);
		Пока Ит.ПолучитьСубконто(2) = 1 Цикл
			Ит.ВыбратьСубконто(3);
			Пока Ит.ПолучитьСубконто(3) = 1 Цикл
				глПроводка(Контекст,,"ЗП",,"Закрытие заказов", Ит.СКД("К"),,,,Ит.Субконто(3), Ит.Субконто(1), Ит.Субконто(2),,,"ЗП");
			КонецЦикла;			
		КонецЦикла;
	КонецЦикла;
	
	глКомментарий("Окончание",2,Контекст);
	
	Операция.Записать();
КонецПроцедуры                                                                                                                                          
