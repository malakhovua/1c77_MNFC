// ===========================
Функция ПроверкаШапки()
    глВсеВыбрано = 1;
	глПроверкаДатыДок(Контекст,"Проведение");
    глВыбранЛи(Фирма,"Фирма");
  	глВсеВыбрано = ?(глВсеВыбрано = 0, 0, глПроверкаДублейСтрок(Контекст));
	
    Возврат глВсеВыбрано;
КонецФункции

// ===========================
Функция ПроверкаСтроки()
    глВсеВыбрано = 1;
    глВыбранЛи(Продукция,"Продукция",НомерСтроки);
	
    Возврат глВсеВыбрано;
КонецФункции
                       
// ===============================
Процедура ОбработкаПроведения(ЧастичноПровести = 0)
	глКомментарий("Начало",2,Контекст);
	Если ПроверкаШапки()=0 Тогда
	    глНеПроводить(Контекст);
	    Возврат;
	КонецЕсли;

	ВыбратьСтроки();
	Пока ПолучитьСтроку()>0 Цикл		
		Если ПроверкаСтроки() = 0 Тогда
			ФлагЕстьОшибки = 1;
		КонецЕсли;	
	КонецЦикла;	

	Если ФлагЕстьОшибки = 1 Тогда
		глНеПроводить(Контекст);
		Возврат;
	КонецЕсли;
	
	СписокТМЦ = СоздатьОбъект("СписокЗначений");
	ВыгрузитьТабличнуюЧасть(СписокТМЦ, "Продукция");
	ТЗАкций = глЗаполнитьТЗАкций(ДатаДок, СписокТМЦ);
	глПроверитьАкции(ТЗАкций, ТекущийДокумент(), ДатаДок, 0);
	Если Константа.ВключитьПлановыеОстатки.Получить(ДатаДок) = Да Тогда
		ВыбратьСтроки();
		Пока ПолучитьСтроку()>0 Цикл
			Регистр.Остатки.ПривязыватьСтроку(НомерСтроки);
			Регистр.Остатки.Фирма = Фирма;
			Регистр.Остатки.МестоХранения= Константа.СкладПланПроизводство;
			Регистр.Остатки.ТМЦ = Продукция;
			Регистр.Остатки.ОстатокТовара = КвоКг;
			Регистр.Остатки.ФлагУчета = 2;
			Регистр.Остатки.ФлагСписания= 3;
			Регистр.Остатки.ДвижениеПриходВыполнить();
		КонецЦикла;
	КонецЕсли;

	РежимПроведения=0;
	глКомментарий("Окончание",2,Контекст);
КонецПроцедуры