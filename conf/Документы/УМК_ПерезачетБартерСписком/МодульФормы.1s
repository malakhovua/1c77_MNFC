Перем ВидПокупатель, ВидПоставщик;
Перем НачальнаяДатаДокумента;

Перем СтруктИзменений;		//--- УМК Сандомирский В.Ю. (10.09.14) --- при перепроведении без изменений не менять автора

// ===============================
Функция УстДоступность()
	
    Форма.Заголовок(глЗаголовок(Контекст,"Взаимозачет списком"));	
	Возврат "";
	
КонецФункции
    
// ===============================
Процедура ПриРедактированииНовойСтроки()
	
	ВидКонтрагентаОткуда 	= ВидПокупатель;
	ВидКонтрагентаКуда 		= ВидПокупатель;
	Если Валюта = Гривня Тогда
		СчетОткуда				= СчетПоКоду("361");
		СчетКуда				= СчетПоКоду("361");
	Иначе
		СчетОткуда				= СчетПоКоду("362");
		СчетКуда				= СчетПоКоду("362");
	КонецЕсли;
	
	
КонецПроцедуры

// ===============================
Процедура ПриНачалеРедактированияСтроки()
	

	
КонецПроцедуры

// ===============================
Процедура ИзмСуммаВал()  
	
	СуммаГрн = глПересчет(СуммаВал,Валюта,Гривня,ДатаДок);
		
КонецПроцедуры

// ===============================
Процедура ИзмСуммаВалПокупатель()
	                                                                             
	// --- СуммаГрнПокупатель = глПересчет(СуммаВалПокупатель,Валюта,Гривня,ДатаДок);
	
КонецПроцедуры
                    
// ===============================
Процедура ИзмВидКонтрагента()
	//Если ВидКонтрагента = ВидПокупатель Тогда
	//    СуммаВалПоставщик = 0;
	//	СуммаГрнПоставщик = 0;
	//	//Если ПустоеЗначение(Счет) = 0 Тогда
	//	//	Если Счет.Контрагент <> Покупатель Тогда
	//	//	    Счет= 0;
	//	//	КонецЕсли;
	//	//КонецЕсли;
	//Иначе
	//    СуммаВалПокупатель = 0;
	//	СуммаГрнПокупатель = 0;
	//	//Если ПустоеЗначение(Счет) = 0 Тогда
	//	//	Если Счет.Контрагент <> Поставщик Тогда
	//	//		Счет = 0;
	//	//	КонецЕсли;
	//	//КонецЕсли;
	//КонецЕсли;
КонецПроцедуры
                                 
//// ===============================
//Процедура ИзмПокупатель()
//	Если ПустоеЗначение(Поставщик)=1 Тогда
//	    Поставщик = Покупатель;
//	КонецЕсли;
//	
//	Если ПустоеЗначение(Покупатель)=0 Тогда
//	    Если Покупатель.ВидКонтрагента = Перечисление.ВидыКонтрагентов.Нерезидент Тогда
//			Если СчетПокупателя = СчетПоКоду("361") Тогда
//			    СчетПокупателя = СчетПоКоду("362");
//			КонецЕсли;
//		Иначе
//			Если СчетПокупателя = СчетПоКоду("362") Тогда
//			    СчетПокупателя = СчетПоКоду("361");
//			КонецЕсли;
//	    КонецЕсли;
//	КонецЕсли;
//	
//	ВыбратьСтроки();
//	Пока ПолучитьСтроку() = 1 Цикл
//		Если ВидКонтрагента = ВидПокупатель Тогда
//			Если ПустоеЗначение(Счет) = 0 Тогда
//				Попытка
//					Если Счет.Контрагент <> Покупатель Тогда
//						Счет = ПолучитьПустоеЗначение("Документ");
//						СуммаВалПокупатель = 0;
//						СуммаГрнПокупатель = 0;
//					КонецЕсли;
//				Исключение КонецПопытки;
//			КонецЕсли;
//		КонецЕсли;
//	КонецЦикла;
//КонецПроцедуры
//
//// ===============================
//Процедура ИзмПоставщик()
//	Если ПустоеЗначение(Покупатель)=1 Тогда
//	    Покупатель = Поставщик;
//	КонецЕсли;
//	Если ПустоеЗначение(Поставщик)=0 Тогда
//	    Если Поставщик.ВидКонтрагента = Перечисление.ВидыКонтрагентов.Нерезидент Тогда
//			Если СчетПоставщика = СчетПоКоду("631") Тогда
//			    СчетПоставщика = СчетПоКоду("632");
//			КонецЕсли;
//		Иначе
//			Если СчетПоставщика = СчетПоКоду("632") Тогда
//			    СчетПоставщика = СчетПоКоду("631");
//			КонецЕсли;
//	    КонецЕсли;
//	КонецЕсли;
//	ВыбратьСтроки();
//	Пока ПолучитьСтроку() = 1 Цикл
//		Если ВидКонтрагента = ВидПоставщик Тогда
//			Если ПустоеЗначение(Счет) = 0 Тогда
//				Попытка
//					Если Счет.Контрагент <> Поставщик Тогда
//						Счет = ПолучитьПустоеЗначение("Документ");
//						СуммаВалПоставщик = 0;
//						СуммаГрнПоставщик = 0;
//					КонецЕсли;
//				Исключение КонецПопытки;
//			КонецЕсли;
//		КонецЕсли;
//	КонецЦикла;
//КонецПроцедуры                  

//======================================================================
Процедура ПересчетСуммГрн()
	
	ВыбратьСтроки();
	Пока ПолучитьСтроку() = 1 Цикл	
		СуммаГрн = СуммаВал * Курс / Кратность;	
	КонецЦикла;
	
КонецПроцедуры // ПересчетСуммГрн

//======================================================================
Процедура ИзмКурс()
	ПересчетСуммГрн();
КонецПроцедуры // гл


// ===============================
Процедура ИзмВалюта()
	
	Курс 		= глКурсДляВалюты(Валюта,ДатаДок);
	Кратность 	= глКратностьДляВалюты(Валюта,ДатаДок);
	
	глСохранитьЗначение(Контекст,"Валюта",Валюта);
	ИзмКурс();

КонецПроцедуры

// ======================================
Процедура ИзмФирма()
	Если Фирма <> глВосстановитьЗначение(Контекст,"Фирма") Тогда
		Если КоличествоСтрок()>0 Тогда
			Рез = Вопрос("Фирма была изменена. Удалить строки?","Да+Нет");
			Если Рез ="Да" Тогда
				УдалитьСтроки();
			Иначе
				Фирма = глВосстановитьЗначение(Контекст,"Фирма");
				глУстановитьНомер(Контекст);
				Возврат;
			КонецЕсли;
		КонецЕсли;
		глСохранитьЗначение(Контекст,"Фирма",Фирма);
	КонецЕсли;
КонецПроцедуры                      

// ===============================
Процедура ПриЗаписи()
	
	Если глЕстьИзменения(Контекст, СтруктИзменений) = 1 Тогда	//--- УМК Сандомирский В.Ю. (10.09.14) --- при перепроведении без изменений не менять автора		
		Автор = глПользователь;															
	КонецЕсли;
	
//	глПроверкаДатыДок(Контекст,"Запись");
	Если глКонтрольДатыДокумента(Контекст, НачальнаяДатаДокумента)=1 Тогда
		СтатусВозврата(0);
	КонецЕсли;
			 
КонецПроцедуры

// ===============================
Процедура ПриОткрытии()
	Форма.кПравоваяПоддержка.Видимость(глВидимостьПравовойПоддержки);
	глПроверкаДатыДок(Контекст,"Открытие");
	НачальнаяДатаДокумента = ДатаДок;
	ПриЗаписиПерепроводить(1);
	// Если открыли только на просмотр, то надо кнопки сделать недоступными
	Если Форма.ТолькоПросмотр()=1 Тогда
//		Форма.кОК.Доступность(0);
//		Форма.кДействия.Доступность(0);
		Форма.ДоговорКонтрагентаКуда.Доступность(1);
		Форма.ДоговорКонтрагентаОткуда.Доступность(1);
		Форма.кФирма.Доступность(0);               		
		Форма.КнопкаПоУмолчанию("кЗакрыть");
	Иначе
		Форма.КнопкаПоУмолчанию("кОК");
	КонецЕсли; 
	глСохранитьЗначение(Контекст,"Валюта",Валюта);
	глСохранитьЗначение(Контекст,"Фирма",Фирма);
	
	глЗагрузитьДокументВСтруктуру(Контекст, СтруктИзменений); //--- УМК Сандомирский В.Ю. (10.09.14) --- при перепроведении без изменений не менять автора
	
КонецПроцедуры

// ======================================
Процедура ВводНового(ПризнакКопирования)
	Если ПризнакКопирования = 1 Тогда
		глУстановитьНомер(Контекст);
		Возврат;
	КонецЕсли;
	глУстановитьФирму(Контекст);
	СчетПоставщика = СчетПоКоду("631");
	СчетПокупателя = СчетПоКоду("361");
	
	Валюта = Гривня; ИзмВалюта();
	ВидНДС = Константа.БазНДС;
	
КонецПроцедуры 

// ===============================
Процедура ПриНачалеВыбораЗначения(Рекв,ФлагСтандОбр) 
	
	Если Рекв = "ДоговорКонтрагентаОткуда" Тогда	// выбираем договор откуда
		Фрм = СоздатьОбъект("СписокЗначений");
		Фрм.ДобавитьЗначение("ДоговораКонтрагентов","ГрафаОтбора");
		Фрм.ДобавитьЗначение(КонтрагентОткуда,"Контрагент");
		ОткрытьПодбор("Журнал.ПолныйЖурнал","ДляВыбораДоговоровИСчетов",Фрм,0,ДоговорКонтрагентаОткуда);
		ФлагСтандОбр=0;
	ИначеЕсли  Рекв = "ДоговорКонтрагентаКуда" Тогда	// выбираем договор откуда
		Фрм = СоздатьОбъект("СписокЗначений");
		Фрм.ДобавитьЗначение("ДоговораКонтрагентов","ГрафаОтбора");
		Фрм.ДобавитьЗначение(КонтрагентКуда,"Контрагент");
		ОткрытьПодбор("Журнал.ПолныйЖурнал","ДляВыбораДоговоровИСчетов",Фрм,0,ДоговорКонтрагентаКуда);
		ФлагСтандОбр=0;	
	КонецЕсли;
	
КонецПроцедуры            


//======================================================================
Процедура ИзмПлюсМинус()
		
	
	
КонецПроцедуры // ИзмПлюсМинус()


//====================================================================== УМК Сандомирский В.Ю. (*) //--- заголовок FormEx_ПланРаскраски
Функция Раскраска()
	ТекстПлана = "(BRUSH_S[" + Строка(100*255*100) + "])()()"; //--- добавляя колонку вначало документа до "раскрашек" часов добавить "()"
	Возврат  ТекстПлана;	
КонецФункции



ВидПокупатель = Перечисление.ВидыКлиентов.Покупатель;
ВидПоставщик = Перечисление.ВидыКлиентов.Поставщик;

// ===============================
// Инициализируем список действий по кнопке "Действия"
СписокДействий = глПолучитьСписокДействий("
	|СтруктураПодчиненности,
	|ДвиженияДокумента,
	|ОткрытьВЖурнале");
