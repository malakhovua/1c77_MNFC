Перем спПодбора;

Функция ИмеютсяПрочМатериалы(ТекущийДокумент)
	
	//Строки документа
	ТекущийДокумент.ВыбратьСтроки();
	
	Пока ТекущийДокумент.ПолучитьСтроку() = 1 Цикл
		Если (ТекущийДокумент.Элемент.Вид() = "ТМЦ") И (ТекущийДокумент.Элемент.НеУчитыватьВОбщемВесе = 1) Тогда
			Возврат 1	
		КонецЕсли;
	КонецЦикла;
	
	Возврат 0;
	
КонецФункции

//*******************************************
// Процедура генерации запроса Сформировать.
//
Процедура Сформировать()
	
	Если ПустоеЗначение(Период) = 1 Тогда
		Сообщить("Период не заполнен !");
		Возврат;
	КонецЕсли;
      
	Таб = СоздатьОбъект("Таблица");
	Таб.ИсходнаяТаблица("ТаблицаОтчета");
	// Заполнение полей "Заголовок"
	Таб.ВывестиСекцию("Заголовок");
	
	// Подготовка к заполнению выходных форм данными запроса
	Состояние("Заполнение выходной таблицы...");

	Таб.Опции(0, 0, Таб.ВысотаТаблицы(), 0);
	
	Запрос = СоздатьОбъект("Запрос");
	ТекстЗапроса = 
	"//{{ЗАПРОС(Сформировать)
	|ТекущийЭлемент = Справочник.ТМЦ.ТекущийЭлемент;
	|Группировка ТекущийЭлемент;
	|Условие(ТекущийЭлемент в СписокВыбТМЦ);
	|"//}}ЗАПРОС
	;
	// Если ошибка в запросе, то выход из процедуры
	Если Запрос.Выполнить(ТекстЗапроса) = 0 Тогда
		Возврат;
	КонецЕсли;
	
	Пока Запрос.Группировка(1) = 1 Цикл
		
		ТекущийДокумент = Запрос.ТекущийЭлемент.НормыЗатрат.Получить(Период);
		
		Если (ПустоеЗначение(ТекущийДокумент) = 1) И (Запрос.ТекущийЭлемент.ЭтоГруппа() = 0) Тогда
			Продолжить;
		КонецЕсли;
		
		//Номенклатура
		Если Запрос.ТекущийЭлемент.ЭтоГруппа() = 1 Тогда
			Таб.ВывестиСекцию("ТекущийЭлементГруппа");
		Иначе
			Если ИмеютсяПрочМатериалы(ТекущийДокумент) = 0 Тогда
				Продолжить;
			КонецЕсли;
			Таб.ВывестиСекцию("ТекущийЭлемент");
		КонецЕсли;
		

		Если Запрос.ТекущийЭлемент.ЭтоГруппа() = 1 Тогда
			Продолжить;
		КонецЕсли;
		
		//Документ	
		Таб.ВывестиСекцию("ТекущийДокумент");
		
		//Маркировка
		Если ПустоеЗначение(Запрос.ТекущийЭлемент.Маркировка) = 0 Тогда
			Таб.ВывестиСекцию("Маркировка");
		КонецЕсли;
		
		//Строки документа
		ТекущийДокумент.ВыбратьСтроки();
		
		Пока ТекущийДокумент.ПолучитьСтроку() = 1 Цикл
			Если ТекущийДокумент.Элемент.НеУчитыватьВОбщемВесе = 1 Тогда
				Кол = Окр(ТекущийДокумент.Элемент.НормаКГФарша.Получить(Период) * ТекущийДокумент.КвоПродукции,3);
				Таб.ВывестиСекцию("СтрокаДокумента");
			КонецЕсли;
		КонецЦикла;
		
	КонецЦикла;
	
	Таб.ВывестиСекцию("Футер");
	
    // Вывод заполненной формы
	Таб.ТолькоПросмотр(1);
	Таб.Показать("Звіт: Інші матеріали у складі продукції", "");
	
КонецПроцедуры  

Процедура ПриОткрытии()
	
	Период = РабочаяДата()
	
КонецПроцедуры

//*******************************************
Процедура ОбработкаПодбора(Выб,Конт) 	
	спПодбора.ДобавитьЗначение(Выб);
КонецПроцедуры

//*******************************************
Процедура Подбор(спЗнач, ВидСпр, Реж)
	Перем ВыбЗначение,Тек,Фрм;
	спПодбора = спЗнач;
	ОткрытьПодбор("Справочник."+ВидСпр,,Фрм,Реж,Тек);
	Фрм.ВыборГруппы(1);
КонецПроцедуры

//*******************************************
Процедура Удалить(Список,Поз)
	Попытка
		Список.УдалитьЗначение(Поз);
	Исключение 
	КонецПопытки;
КонецПроцедуры 



