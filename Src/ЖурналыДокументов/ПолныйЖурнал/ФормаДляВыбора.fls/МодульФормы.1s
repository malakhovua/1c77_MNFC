Перем ИмяФормы;
Перем спРасшифровка;

// ===============================
// Описание переменных 
Перем СписокВидовДокументов, ТипыУчета;                                                                                                                     
Перем КонтрагентДляОтбора,ФирмаДляОтбора,ВидДокументаДляОтбора,АвторДляОтбора,ТипДляОтбора;
Перем ЗначениеВВидеСтроки;

// ===============================
// функции и процедуры, вызываемые из формул элементов диалога

// ===============================
Функция Валюта()
    Если глЕстьРеквизитШапки("Валюта",ТекущийДокумент.Вид()) = Да Тогда
		Возврат ТекущийДокумент.Валюта.Кратко;
	Иначе
		Возврат "";
    КонецЕсли;
КонецФункции

// ===============================
Процедура ПриВыбореКонтрагента()   
	
	Если КонтрагентДляОтбора.Выбран()>0 Тогда
		УстановитьОтбор("Контрагент", КонтрагентДляОтбора);
		КонтрагентДляОтбора = КонтрагентДляОтбора.ТекущийЭлемент();
	Иначе
		УстановитьОтбор("");
	КонецЕсли;
	
КонецПроцедуры 

// ===============================
//
Процедура ПриУстановкеБыстрогоОтбора()
	Перем ТекущДок;                           
	
	ТекущДок = ТекущийДокумент;
	
	Если ВидОтбора.ТекущаяСтрока() = 6 Тогда	// нет быстрого отбора
		    
		ЗначениеВВидеСтроки = "";
		
		Форма.кнЗначение.Доступность(0);
		УстановитьОтбор("");
		ВидыОтбора("*");

	Иначе		// есть быстрый отбор
        
		Форма.кнЗначение.Доступность(1);
		
		Если ВидОтбора.ТекущаяСтрока() = 1 Тогда
			ПриВыбореКонтрагента();
			ЗначениеВВидеСтроки=Строка(КонтрагентДляОтбора);
			
		КонецЕсли;
		
		ВидыОтбора("");
		
	КонецЕсли;
	
	Попытка
		АктивизироватьОбъект(ТекущДок);
	Исключение	
	КонецПопытки;	
		
КонецПроцедуры // ПриУстановкеБыстрогоОтбора


// ===============================
Процедура ПриВыбореСтроки()
	Если (Форма.РежимВыбора()=0) и (Форма.МодальныйРежим()=1) Тогда
		Док = СоздатьОбъект("Документ");
		Док = ТекущийДокумент;
		спРасшифровка.УдалитьВсе();
		Если Док.ПометкаУдаления() = 1 тогда
			Форма.Закрыть();
		Иначе	                               
			спРасшифровка.ДобавитьЗначение(ТекущийДокумент,"ДокументОснование");
			Форма.Закрыть();
		КонецЕсли;	
	КонецЕсли;
КонецПроцедуры                               

// ===============================
// Предопределенные процедуры
// ===============================
Процедура ПриОткрытии()                                        
	Форма.ОбработкаВыбораСтроки(1);
	Если ПустоеЗначение(Форма.Параметр)=0 Тогда
		Если ТипЗначенияСтр(Форма.Параметр)="СписокЗначений" Тогда
			спРасшифровка = Форма.Параметр;
	            КонтрагентДляОтбора = спРасшифровка.Получить("Контрагент");
		ИначеЕсли ТипЗначенияСтр(Форма.Параметр)="Справочник" Тогда
			КонтрагентДляОтбора = Форма.Параметр;    
		КонецЕсли;
		
		ВидОтбора.ТекущаяСтрока(1);
		ПриУстановкеБыстрогоОтбора();
		РазрешитьОтбор = 0;
	Иначе
		// Определение был ли быстрый отбор
		ВидОтбора.ТекущаяСтрока(6);
		ПриУстановкеБыстрогоОтбора();
	КонецЕсли;
	
	// будем отслеживать только реальные изменения этих реквизитов
	Форма.ВидОтбора.ВыполнятьФормулуТолькоПриИзменении(1);               
	
	Если ВидОтбора.ТекущаяСтрока()=1 Тогда
	    // нельзя менять отбор
		РазрешитьОтбор=0;
		Форма.ВидОтбора.Доступность(0);
		Форма.кнЗначение.Доступность(0);
	КонецЕсли;
	
КонецПроцедуры

// ===============================
//
Процедура ПриЗакрытии() // Предопределенная процедура
КонецПроцедуры // ПриЗакрытии
// ===============================

ТипыУчета = СоздатьОбъект("СписокЗначений");
ТипыУчета.ДобавитьЗначение("Упр.","Упр.");
ТипыУчета.ДобавитьЗначение("Общ.","Общ.");
ТипыУчета.ДобавитьЗначение("Фин.","Фин.");
    
СписокВидовДокументов = СоздатьОбъект("СписокЗначений");
Для Счетчик = 1 по Метаданные.Документ() Цикл
	СписокВидовДокументов.ДобавитьЗначение(Метаданные.Документ(Счетчик).Идентификатор, Метаданные.Документ(Счетчик).Представление());
КонецЦикла;
СписокВидовДокументов.СортироватьПоПредставлению();
	                  
ВидОтбора.ДобавитьЗначение("по контрагенту"); 
ВидОтбора.ДобавитьЗначение("по виду документов"); 
ВидОтбора.ДобавитьЗначение("по автору"); 
ВидОтбора.ДобавитьЗначение("по типу учета");  
ВидОтбора.ДобавитьЗначение("по фирме"); 
ВидОтбора.ДобавитьЗначение("отсутствует");

ЖурналПоДоговору = 0;

КонтрагентДляОтбора = СоздатьОбъект("Справочник.Контрагенты");  
ФирмаДляОтбора = СоздатьОбъект("Справочник.Фирмы"); 
АвторДляОтбора = СоздатьОбъект("Справочник.Пользователи");
ТипДляОтбора = 1; 
ВидДокументаДляОтбора = 1;

ЗначениеВВидеСтроки = "";

ИмяФормы = "Журнал.ПолныйЖурнал.Форма.ФормаДляВыбора";
